<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>2026학년도 한들물빛초 6학년 환영합니다</title>
    
    <!-- React & ReactDOM -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    
    <!-- Babel -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300;400;500;700&display=swap" rel="stylesheet">

    <style>
        body { font-family: 'Noto Sans KR', sans-serif; background-color: #f8f9fa; }
        .hide-scrollbar::-webkit-scrollbar { display: none; }
        .hide-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
        .menu-card:hover { transform: translateY(-2px); transition: all 0.2s; }
        
        @keyframes slide-up {
            from { transform: translateY(100%); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }
        .animate-slide-up { animation: slide-up 0.3s ease-out forwards; }
        
        @keyframes fade-in-up {
            from { transform: translate(-50%, 20px); opacity: 0; }
            to { transform: translate(-50%, 0); opacity: 1; }
        }
        .animate-fade-in-up { animation: fade-in-up 0.3s ease-out forwards; }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, signInAnonymously, signInWithCustomToken, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, collection, doc, addDoc, updateDoc, deleteDoc, onSnapshot, query, orderBy } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

        // 전역 객체에 Firebase 함수 노출 (React 컴포넌트에서 사용하기 위함)
        window.FirebaseData = {
            initializeApp, getAuth, signInAnonymously, signInWithCustomToken, onAuthStateChanged,
            getFirestore, collection, doc, addDoc, updateDoc, deleteDoc, onSnapshot, query, orderBy
        };
    </script>

    <script type="text/babel">
        const { useState, useEffect, useMemo } = React;

        // --- 아이콘 컴포넌트 정의 ---
        const Icons = {
            UtensilsCrossed: ({size=24, className=""}) => (
                <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><path d="m16 2-2.3 2.3a3 3 0 0 0 0 4.2l1.8 1.8a3 3 0 0 0 4.2 0L22 8"/><path d="M15 15 3.3 3.3a4.2 4.2 0 0 0 0 6l7.3 7.3c.7.7 2 .7 2.8 0L15 15Zm0 0 7 7"/><path d="m2.1 21.8 6.4-6.3"/><path d="m19 5-7 7"/></svg>
            ),
            ShoppingCart: ({size=24, className=""}) => (
                <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><circle cx="8" cy="21" r="1"/><circle cx="19" cy="21" r="1"/><path d="M2.05 2.05h2l2.66 12.42a2 2 0 0 0 2 1.58h9.78a2 2 0 0 0 1.95-1.57l1.65-7.43H5.12"/></svg>
            ),
            Plus: ({size=24, className=""}) => (
                <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><path d="M5 12h14"/><path d="M12 5v14"/></svg>
            ),
            Minus: ({size=24, className=""}) => (
                <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><path d="M5 12h14"/></svg>
            ),
            Trash2: ({size=24, className=""}) => (
                <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><path d="M3 6h18"/><path d="M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6"/><path d="M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2"/><line x1="10" x2="10" y1="11" y2="17"/><line x1="14" x2="14" y1="11" y2="17"/></svg>
            ),
            Copy: ({size=24, className=""}) => (
                <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><rect width="14" height="14" x="8" y="8" rx="2" ry="2"/><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"/></svg>
            ),
            CheckCircle2: ({size=24, className=""}) => (
                <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><circle cx="12" cy="12" r="10"/><path d="m9 12 2 2 4-4"/></svg>
            ),
            X: ({size=24, className=""}) => (
                <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><path d="M18 6 6 18"/><path d="m6 6 12 12"/></svg>
            ),
            Image: ({size=24, className=""}) => (
                <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><rect width="18" height="18" x="3" y="3" rx="2" ry="2"/><circle cx="9" cy="9" r="2"/><path d="m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21"/></svg>
            ),
            ExternalLink: ({size=24, className=""}) => (
                <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"/><polyline points="15 3 21 3 21 9"/><line x1="10" x2="21" y1="14" y2="3"/></svg>
            ),
            User: ({size=24, className=""}) => (
                <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><path d="M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2"/><circle cx="12" cy="7" r="4"/></svg>
            ),
            Cloud: ({size=24, className=""}) => (
                <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><path d="M17.5 19c0-1.7-1.3-3-3-3h-1.1c-.2-2.3-2.1-4-4.4-4-2.5 0-4.5 1.8-4.9 4.2-2.1.3-3.7 2.2-3.7 4.4 0 2.4 2 4.4 4.4 4.4h8.3c2.4 0 4.4-1.9 4.4-4.4z"/></svg>
            )
        };

        const { ShoppingCart, Trash2, Plus, Minus, Copy, CheckCircle2, UtensilsCrossed, X, Image, ExternalLink, User, Cloud } = Icons;

        // --- 데이터 구성 ---
        const MENU_DATA = [
            { id: 1, category: '대표 메뉴', name: '투움바 파스타', price: 12900, description: '파르미지아노 레지아노 치즈를 사용하여 만든 투움바 파스타.', signature: true },
            { id: 2, category: '대표 메뉴', name: '알배추 샐러드', price: 9900, description: '직화로 겉면을 태워 풍미를 더한 알배추, 치즈의 고소한 조화', signature: true },
            { id: 3, category: '대표 메뉴', name: '목살 플레이트', price: 14500, description: '돼지고기 목살, 샐러드, 감자튀김', signature: true },
            { id: 4, category: '대표 메뉴', name: '시금치 플렛 피자', price: 13900, description: '수제 화이트 소스, 시금치, 토마토, 햄을 돌돌 말아 먹는 피자', signature: true },
            { id: 5, category: '대표 메뉴', name: '전복 내장 크림 새우 리조또', price: 14500, description: '진한 전복내장과 게우소스 크림, 탱글한 새우', signature: true },
            { id: 6, category: '대표 메뉴', name: '브런치 루꼴라 피자', price: 14500, description: '루꼴라 듬뿍, 델리 햄, 페퍼로니, 베이컨', signature: true },
            { id: 7, category: '대표 메뉴', name: '전복 내장 크림 새우 파스타', price: 14500, description: '진한 전복내장과 게우소스 크림, 탱글한 새우', signature: true },
            { id: 8, category: '피자', name: '바싹 불고기 피자', price: 11900 },
            { id: 9, category: '피자', name: '소보루 고르곤졸라 피자', price: 11900 },
            { id: 10, category: '피자', name: '허니 콘치즈 피자', price: 11500 },
            { id: 11, category: '피자', name: '잔나비 피자', price: 11500 },
            { id: 12, category: '피자', name: '소보루 고구마 피자', price: 13500 },
            { id: 13, category: '피자', name: '고구마 무스 피자', price: 11500 },
            { id: 14, category: '피자', name: '포테이토 피자', price: 10900 },
            { id: 15, category: '피자', name: '페퍼로니 피자', price: 10900 },
            { id: 16, category: '피자', name: '부어스트 핫도그 피자', price: 13500, description: '한 조각에 독일 소시지가 하나씩 들어간 핫도그 피자' },
            { id: 17, category: '피자', name: '반반 피자', price: 11500, description: '페페로니 / 포테이토 반반' },
            { id: 18, category: '피자', name: '옥수수 새우 피자', price: 13900, description: '불향 가득, 옥수수와 새우의 단짠 조합' },
            { id: 19, category: '파스타', name: '새우 알리오 올리오 파스타', price: 10500 },
            { id: 20, category: '파스타', name: '매콤 해물 로제 파스타', price: 10500 },
            { id: 21, category: '파스타', name: '매콤 불고기 로제 파스타', price: 10500 },
            { id: 22, category: '파스타', name: '매콤 불고기 토마토 파스타', price: 9900 },
            { id: 23, category: '파스타', name: '바질 크림 불고기 파스타', price: 11500 },
            { id: 24, category: '파스타', name: '매콤 해물 토마토 파스타', price: 9900 },
            { id: 25, category: '파스타', name: '매콤 불고기 크림 파스타', price: 9900 },
            { id: 26, category: '파스타', name: '해물 크림 파스타', price: 9900 },
            { id: 27, category: '파스타', name: '베이컨 크림 파스타', price: 9900 },
            { id: 28, category: '파스타', name: '새우 바질 오일 파스타', price: 11900 },
            { id: 29, category: '파스타', name: '매콤 페퍼로니 토마토 파스타', price: 9900 },
            { id: 30, category: '리조또', name: '매콤 크림불고기 리조또', price: 9900 },
            { id: 31, category: '리조또', name: '바질 크림 불고기 리조또', price: 11500 },
            { id: 32, category: '리조또', name: '매콤 불고기 로제 리조또', price: 10500 },
            { id: 33, category: '리조또', name: '매콤 해물 로제 리조또', price: 10500 },
            { id: 34, category: '리조또', name: '매콤 불고기 토마토 리조또', price: 9900 },
            { id: 35, category: '리조또', name: '매콤 해물 토마토 리조또', price: 9900 },
            { id: 36, category: '리조또', name: '베이컨 크림치즈 리조또', price: 9900 },
            { id: 37, category: '샐러드/사이드', name: '리코타 치즈 샐러드', price: 9900 },
            { id: 38, category: '샐러드/사이드', name: 'Crane 샐러드', price: 6900, description: '기본 샐러드' },
            { id: 39, category: '샐러드/사이드', name: '케이준 치킨 샐러드', price: 10500 },
            { id: 40, category: '샐러드/사이드', name: '버팔로윙스&감자튀김', price: 10500, description: '버팔로 윙, 봉(각 3개)과 케이준 포테이토' },
            { id: 41, category: '샐러드/사이드', name: '크리스피텐더&감자튀김', price: 10900 },
            { id: 42, category: '샐러드/사이드', name: '치즈볼(4개)', price: 4500 },
            { id: 43, category: '샐러드/사이드', name: '고구마 치즈볼(4개)', price: 4500 },
            { id: 44, category: '샐러드/사이드', name: '케이준 포테이토', price: 6500 },
            { id: 45, category: '샐러드/사이드', name: '버터갈릭 포테이토', price: 7900 },
            { id: 46, category: '샐러드/사이드', name: '스위트 포테이토(고구마)', price: 7900 },
            { id: 47, category: '주류/음료', name: '청포도 맥주', price: 5500 },
            { id: 48, category: '주류/음료', name: '핑크자몽 맥주', price: 5500 },
            { id: 49, category: '주류/음료', name: '생맥주 500ml', price: 4900 },
            { id: 50, category: '주류/음료', name: '생맥주 380ml', price: 3900 },
            { id: 51, category: '주류/음료', name: '청포도 하이볼', price: 6900 },
            { id: 52, category: '주류/음료', name: '자몽 하이볼', price: 6900 },
            { id: 53, category: '주류/음료', name: '블루 하이볼', price: 6900 },
            { id: 54, category: '주류/음료', name: '짐빔 토닉 하이볼', price: 6500 },
            { id: 55, category: '주류/음료', name: '산토닉 토닉 하이볼', price: 6500 },
        ];

        const CATEGORIES = ['전체', '대표 메뉴', '파스타', '피자', '리조또', '샐러드/사이드', '주류/음료'];

        const App = () => {
            const [activeCategory, setActiveCategory] = useState('전체');
            const [cart, setCart] = useState([]);
            const [user, setUser] = useState(null);
            const [isCartOpen, setIsCartOpen] = useState(false);
            const [toast, setToast] = useState(null);
            
            const [isNameModalOpen, setIsNameModalOpen] = useState(false);
            const [pendingItem, setPendingItem] = useState(null);
            const [ordererName, setOrdererName] = useState('');

            // Firebase refs
            const [db, setDb] = useState(null);
            const [appId, setAppId] = useState('');

            // 1. Firebase Initialization
            useEffect(() => {
                const initFirebase = async () => {
                    if (window.FirebaseData && typeof __firebase_config !== 'undefined') {
                        const { initializeApp, getAuth, signInAnonymously, signInWithCustomToken, onAuthStateChanged, getFirestore } = window.FirebaseData;
                        
                        try {
                            const firebaseConfig = JSON.parse(__firebase_config);
                            const app = initializeApp(firebaseConfig);
                            const auth = getAuth(app);
                            const firestore = getFirestore(app);
                            const currentAppId = typeof __app_id !== 'undefined' ? __app_id : 'default-app-id';
                            
                            setDb(firestore);
                            setAppId(currentAppId);

                            // Auth Rule 3: Call signIn first
                            if (typeof __initial_auth_token !== 'undefined' && __initial_auth_token) {
                                await signInWithCustomToken(auth, __initial_auth_token);
                            } else {
                                await signInAnonymously(auth);
                            }

                            onAuthStateChanged(auth, (u) => {
                                setUser(u);
                            });
                        } catch (e) {
                            console.error("Firebase init error:", e);
                        }
                    }
                };
                initFirebase();
            }, []);

            // 2. Real-time Cart Listener (Firestore)
            useEffect(() => {
                if (!user || !db || !window.FirebaseData) return;
                
                const { collection, onSnapshot, query, orderBy } = window.FirebaseData;
                
                // Rule 1: Strict Path for public shared cart
                const cartRef = collection(db, 'artifacts', appId, 'public', 'data', 'shared_cart');
                
                // Rule 2: No complex queries initially, but orderBy might be risky if index missing.
                // Safest to fetch all and sort in client, but let's try simple collection first.
                // If permission errors occur, check Rule 1 path strictly.
                
                const unsubscribe = onSnapshot(cartRef, (snapshot) => {
                    const items = snapshot.docs.map(doc => ({
                        docId: doc.id,
                        ...doc.data()
                    }));
                    // Sort items by name or added time if we stored it
                    setCart(items);
                }, (error) => {
                    console.error("Firestore listener error:", error);
                });

                return () => unsubscribe();
            }, [user, db, appId]);

            useEffect(() => {
                if (toast) {
                    const timer = setTimeout(() => setToast(null), 2000);
                    return () => clearTimeout(timer);
                }
            }, [toast]);

            // Filter Menu
            const filteredMenu = useMemo(() => {
                if (activeCategory === '전체') return MENU_DATA;
                return MENU_DATA.filter(item => item.category === activeCategory);
            }, [activeCategory]);

            // Total Amount
            const totalAmount = useMemo(() => {
                return cart.reduce((sum, item) => sum + (item.price * item.quantity), 0);
            }, [cart]);

            const initAddToCart = (item) => {
                setPendingItem(item);
                // 기존에 입력했던 이름이 있으면 유지
                if (!ordererName) {
                    const storedName = localStorage.getItem('last_order_name');
                    if (storedName) setOrdererName(storedName);
                }
                setIsNameModalOpen(true);
            };

            const confirmAddToCart = async (e) => {
                e.preventDefault();
                if (!pendingItem || !db) return;

                const name = ordererName.trim() || '선생님';
                localStorage.setItem('last_order_name', name); // Remember name

                const { addDoc, updateDoc, doc, collection } = window.FirebaseData;
                const cartRef = collection(db, 'artifacts', appId, 'public', 'data', 'shared_cart');

                // Check if item exists for this person (Client-side check since we have full cart)
                const existingItem = cart.find(i => i.id === pendingItem.id && i.owner === name);

                try {
                    if (existingItem) {
                        // Update quantity
                        await updateDoc(doc(db, 'artifacts', appId, 'public', 'data', 'shared_cart', existingItem.docId), {
                            quantity: existingItem.quantity + 1
                        });
                    } else {
                        // Add new item
                        await addDoc(cartRef, {
                            id: pendingItem.id,
                            name: pendingItem.name,
                            price: pendingItem.price,
                            owner: name,
                            quantity: 1,
                            createdAt: Date.now()
                        });
                    }
                    setToast(`${pendingItem.name} (${name}) 담김`);
                } catch (err) {
                    console.error("Add to cart error:", err);
                    setToast("오류가 발생했습니다.");
                }
                
                setIsNameModalOpen(false);
            };

            const updateQuantity = async (docId, currentQty, delta) => {
                if (!db) return;
                const { updateDoc, doc } = window.FirebaseData;
                const newQty = Math.max(1, currentQty + delta);
                
                try {
                    await updateDoc(doc(db, 'artifacts', appId, 'public', 'data', 'shared_cart', docId), {
                        quantity: newQty
                    });
                } catch (err) {
                    console.error("Update qty error:", err);
                }
            };

            const removeFromCart = async (docId) => {
                if (!db) return;
                const { deleteDoc, doc } = window.FirebaseData;
                
                try {
                    await deleteDoc(doc(db, 'artifacts', appId, 'public', 'data', 'shared_cart', docId));
                } catch (err) {
                    console.error("Delete error:", err);
                }
            };

            const clearCart = async () => {
                if (!db) return;
                if (!confirm('공유 장바구니의 모든 메뉴가 삭제됩니다. 계속하시겠습니까?')) return;
                
                const { deleteDoc, doc } = window.FirebaseData;
                
                // Delete all documents one by one
                try {
                    const deletePromises = cart.map(item => 
                        deleteDoc(doc(db, 'artifacts', appId, 'public', 'data', 'shared_cart', item.docId))
                    );
                    await Promise.all(deletePromises);
                    setToast('장바구니가 초기화되었습니다.');
                } catch (err) {
                    console.error("Clear cart error:", err);
                    setToast("삭제 중 오류가 발생했습니다.");
                }
            };

            const formatPrice = (price) => {
                return price.toLocaleString() + '원';
            };

            const copyToClipboard = () => {
                if (cart.length === 0) return;

                const date = new Date().toLocaleDateString();
                let text = `[크레인 메뉴 주문서 - ${date}]\n\n`;
                
                cart.forEach(item => {
                    text += `- ${item.name} (${item.owner}) x ${item.quantity}\n`;
                });
                text += `\n총 합계: ${formatPrice(totalAmount)}`;

                navigator.clipboard.writeText(text).then(() => {
                    setToast('주문서가 복사되었습니다!');
                });
            };

            return (
                <div className="min-h-screen pb-24">
                    {/* Header */}
                    <header className="bg-white shadow-sm sticky top-0 z-40">
                        <div className="max-w-4xl mx-auto px-4 py-4 flex flex-col md:flex-row justify-between items-center gap-4">
                            <div className="flex justify-between w-full md:w-auto items-center">
                                <div>
                                    <h1 className="text-xl font-bold text-gray-800 leading-tight">
                                        2026학년도 한들물빛초 <br className="sm:hidden" />
                                        6학년이 되신 여러분을 환영합니다.
                                    </h1>
                                    <p className="text-sm text-orange-500 font-medium mt-1 flex items-center gap-1">
                                        <UtensilsCrossed size={16} /> CRANE: 선생님들의 맛있는 식사를 위하여
                                    </p>
                                </div>
                                <button 
                                    onClick={() => setIsCartOpen(true)}
                                    className="md:hidden relative p-2 rounded-full hover:bg-gray-100 transition"
                                >
                                    <ShoppingCart size={24} className="text-gray-700" />
                                    {cart.length > 0 && (
                                        <span className="absolute top-0 right-0 bg-orange-500 text-white text-xs font-bold w-5 h-5 flex items-center justify-center rounded-full animate-bounce">
                                            {cart.reduce((a, b) => a + b.quantity, 0)}
                                        </span>
                                    )}
                                </button>
                            </div>
                            
                            <div className="flex items-center gap-3">
                                <a 
                                    href="https://naver.me/xMjKRA2c" 
                                    target="_blank" 
                                    rel="noopener noreferrer"
                                    className="text-xs bg-green-500 hover:bg-green-600 text-white px-3 py-2 rounded-full flex items-center gap-1 transition-colors"
                                >
                                    <ExternalLink size={14} /> 매장 정보(네이버)
                                </a>
                                <button 
                                    onClick={() => setIsCartOpen(true)}
                                    className="hidden md:flex relative p-2 rounded-full hover:bg-gray-100 transition"
                                >
                                    <ShoppingCart size={24} className="text-gray-700" />
                                    {cart.length > 0 && (
                                        <span className="absolute top-0 right-0 bg-orange-500 text-white text-xs font-bold w-5 h-5 flex items-center justify-center rounded-full animate-bounce">
                                            {cart.reduce((a, b) => a + b.quantity, 0)}
                                        </span>
                                    )}
                                </button>
                            </div>
                        </div>

                        {/* Category Nav */}
                        <div className="border-t overflow-x-auto hide-scrollbar bg-white">
                            <div className="flex justify-center px-4 min-w-full">
                                {CATEGORIES.map(cat => (
                                    <button
                                        key={cat}
                                        onClick={() => setActiveCategory(cat)}
                                        className={`py-3 px-4 text-sm font-medium whitespace-nowrap border-b-2 transition-colors duration-200 ${
                                            activeCategory === cat 
                                            ? 'border-orange-500 text-orange-600' 
                                            : 'border-transparent text-gray-500 hover:text-gray-700'
                                        }`}
                                    >
                                        {cat}
                                    </button>
                                ))}
                            </div>
                        </div>
                    </header>

                    {/* Main Content */}
                    <main className="max-w-4xl mx-auto px-4 py-6">
                        {/* Loading State for DB */}
                        {!db && (
                            <div className="text-center py-8 text-gray-500">
                                <Cloud className="inline-block animate-bounce mb-2" />
                                <p>공유 장바구니 연결 중...</p>
                            </div>
                        )}

                        <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                            {filteredMenu.map(item => (
                                <div key={item.id} className="menu-card bg-white rounded-xl shadow-sm border border-gray-100 p-4 flex flex-col justify-between">
                                    <div>
                                        <div className="flex justify-between items-start mb-1">
                                            <h3 className="font-bold text-gray-800 text-lg flex items-center gap-2">
                                                {item.name}
                                                {item.signature && <span className="bg-red-100 text-red-600 text-[10px] px-2 py-0.5 rounded-full font-bold">HIT</span>}
                                            </h3>
                                        </div>
                                        <p className="text-sm text-gray-500 mb-3 min-h-[1.25rem]">
                                            {item.description || item.category}
                                        </p>
                                    </div>
                                    <div className="flex justify-between items-center mt-2">
                                        <span className="font-bold text-lg text-gray-900">{formatPrice(item.price)}</span>
                                        <div className="flex gap-2">
                                            <a 
                                                href={`https://search.naver.com/search.naver?where=image&sm=tab_jum&query=크레인+${encodeURIComponent(item.name)}`}
                                                target="_blank"
                                                rel="noopener noreferrer"
                                                className="bg-gray-100 text-gray-600 hover:bg-gray-200 px-3 py-2 rounded-lg font-medium text-sm transition-colors flex items-center gap-1"
                                                title="네이버 이미지 검색"
                                            >
                                                <Image size={16} /> <span>사진보기</span>
                                            </a>
                                            <button 
                                                onClick={() => initAddToCart(item)}
                                                className="bg-orange-50 text-orange-600 hover:bg-orange-100 px-4 py-2 rounded-lg font-medium text-sm transition-colors flex items-center gap-1"
                                            >
                                                <Plus size={16} /> 담기
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            ))}
                        </div>
                        
                        <p className="text-center text-gray-400 text-xs mt-8 mb-4">
                            메뉴 항목과 가격은 매장 사정에 따라 상이할 수 있습니다. <br/>
                            '사진보기' 버튼을 누르면 해당 메뉴의 이미지를 검색합니다.
                        </p>
                    </main>

                    {/* Toast Notification */}
                    {toast && (
                        <div className="fixed bottom-24 left-1/2 transform -translate-x-1/2 bg-gray-800 text-white px-6 py-3 rounded-full shadow-lg z-50 flex items-center gap-2 animate-fade-in-up text-sm whitespace-nowrap">
                            <CheckCircle2 size={18} className="text-green-400" />
                            {toast}
                        </div>
                    )}

                    {/* Name Input Modal */}
                    {isNameModalOpen && (
                        <div className="fixed inset-0 z-[60] flex items-center justify-center bg-black/50 backdrop-blur-sm p-4">
                            <div className="bg-white rounded-2xl shadow-2xl w-full max-w-sm overflow-hidden animate-slide-up sm:animate-none">
                                <div className="p-5">
                                    <h3 className="text-lg font-bold text-gray-800 mb-1">누구의 메뉴인가요?</h3>
                                    <p className="text-sm text-gray-500 mb-4">주문자 이름을 입력해주세요.</p>
                                    
                                    <form onSubmit={confirmAddToCart}>
                                        <div className="relative mb-4">
                                            <div className="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                                                <User size={18} className="text-gray-400" />
                                            </div>
                                            <input
                                                type="text"
                                                value={ordererName}
                                                onChange={(e) => setOrdererName(e.target.value)}
                                                placeholder="이름 (예: 이원형)"
                                                className="w-full pl-10 pr-4 py-3 bg-gray-50 border border-gray-200 rounded-xl focus:outline-none focus:ring-2 focus:ring-orange-500 focus:bg-white transition-all"
                                                autoFocus
                                            />
                                        </div>
                                        <div className="flex gap-2">
                                            <button 
                                                type="button" 
                                                onClick={() => setIsNameModalOpen(false)}
                                                className="flex-1 py-3 text-gray-500 hover:bg-gray-100 rounded-xl font-medium transition-colors"
                                            >
                                                취소
                                            </button>
                                            <button 
                                                type="submit"
                                                className="flex-1 py-3 bg-orange-600 hover:bg-orange-700 text-white rounded-xl font-bold shadow-md shadow-orange-200 transition-colors"
                                            >
                                                확인
                                            </button>
                                        </div>
                                    </form>
                                </div>
                            </div>
                        </div>
                    )}

                    {/* Cart Modal/Drawer */}
                    {isCartOpen && (
                        <div className="fixed inset-0 z-50 flex items-end sm:items-center justify-center bg-black/50 backdrop-blur-sm transition-opacity">
                            <div className="bg-white w-full max-w-lg h-[80vh] sm:h-auto sm:max-h-[80vh] sm:rounded-2xl rounded-t-2xl shadow-2xl flex flex-col animate-slide-up">
                                <div className="p-4 border-b flex justify-between items-center bg-gray-50">
                                    <h2 className="text-lg font-bold flex items-center gap-2">
                                        <Cloud className="text-orange-500" />
                                        공유 장바구니 ({cart.reduce((a, b) => a + b.quantity, 0)})
                                    </h2>
                                    <button onClick={() => setIsCartOpen(false)} className="p-2 hover:bg-gray-200 rounded-full">
                                        <X size={20} />
                                    </button>
                                </div>
                                
                                <div className="flex-1 overflow-y-auto p-4 space-y-4">
                                    {cart.length === 0 ? (
                                        <div className="h-full flex flex-col items-center justify-center text-gray-400 gap-4">
                                            <Cloud size={48} className="text-gray-200" />
                                            <p>공유 장바구니가 비어있습니다.</p>
                                        </div>
                                    ) : (
                                        cart.map((item, index) => (
                                            <div key={item.docId} className="flex items-center justify-between border-b border-gray-100 pb-4 last:border-0">
                                                <div className="flex-1">
                                                    <div className="flex items-center gap-2 mb-0.5">
                                                        <span className="bg-orange-100 text-orange-700 text-[10px] px-1.5 py-0.5 rounded font-bold flex items-center gap-0.5">
                                                            <User size={10} /> {item.owner}
                                                        </span>
                                                    </div>
                                                    <h4 className="font-medium text-gray-800">{item.name}</h4>
                                                    <span className="text-sm text-gray-500">{formatPrice(item.price * item.quantity)}</span>
                                                </div>
                                                <div className="flex items-center gap-3 bg-gray-50 rounded-lg p-1">
                                                    <button onClick={() => item.quantity > 1 ? updateQuantity(item.docId, item.quantity, -1) : removeFromCart(item.docId)} className="p-1 rounded bg-white shadow-sm text-gray-600 hover:text-red-500">
                                                        {item.quantity === 1 ? <Trash2 size={16} /> : <Minus size={16} />}
                                                    </button>
                                                    <span className="text-sm font-bold w-4 text-center">{item.quantity}</span>
                                                    <button onClick={() => updateQuantity(item.docId, item.quantity, 1)} className="p-1 rounded bg-white shadow-sm text-gray-600 hover:text-green-500">
                                                        <Plus size={16} />
                                                    </button>
                                                </div>
                                            </div>
                                        ))
                                    )}
                                </div>

                                <div className="p-4 border-t bg-gray-50 rounded-b-2xl">
                                    <div className="flex justify-between items-center mb-4">
                                        <span className="text-gray-600">총 결제 예정 금액</span>
                                        <div className="flex items-center gap-3">
                                            {cart.length > 0 && (
                                                <button 
                                                    onClick={clearCart}
                                                    className="text-xs text-gray-400 hover:text-red-500 underline transition-colors flex items-center gap-1"
                                                >
                                                    <Trash2 size={12} /> 전체 삭제
                                                </button>
                                            )}
                                            <span className="text-xl font-bold text-orange-600">{formatPrice(totalAmount)}</span>
                                        </div>
                                    </div>
                                    <button 
                                        onClick={copyToClipboard}
                                        disabled={cart.length === 0}
                                        className="w-full bg-orange-600 hover:bg-orange-700 text-white font-bold py-3.5 px-4 rounded-xl shadow-lg shadow-orange-200 active:scale-[0.98] transition-all flex justify-center items-center gap-2 disabled:bg-gray-300 disabled:shadow-none"
                                    >
                                        <Copy size={20} />
                                        주문서 복사하기
                                    </button>
                                    <p className="text-[10px] text-center text-gray-400 mt-2">
                                        버튼을 누르면 전체 주문 내역이 클립보드에 복사됩니다.
                                    </p>
                                </div>
                            </div>
                        </div>
                    )}
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>